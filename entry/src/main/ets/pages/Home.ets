import { HomeContent } from '../components/content/HomeContent'
import { StatisticsContent } from '../components/content/StatisticsContent'
import { LevelContent } from '../components/content/LevelContent'
import { QualityContent } from '../components/content/QualityContent'
import { ThemeSelector } from '../components/ThemeSelector'
import { OmniThemeManager, OmniThemeType } from '../utils/OmniThemeManager'
import { OmniUIInit } from '../utils/OmniUIInit'
import { OmniUIUtils } from '../utils/OmniUIUtils'
import { OmniBottomTabBar, OmniBottomBarItem } from '@wuba58/omni-ui'
// å¯¼å…¥ IBest-UI ç»„ä»¶
import { IBestButton, IBestIcon, IBestTag, IBestInit } from '@ibestservices/ibest-ui'
import { window } from '@kit.ArkUI'

@Entry
@Component
struct Page {
  @State currentPage: string = 'ä¸»é¡µ'
  @State currentThemeType: OmniThemeType = OmniThemeType.BLUE  // å½“å‰ä¸»é¢˜ç±»åž‹çŠ¶æ€
  @State showThemeSelector: boolean = false  // æŽ§åˆ¶ä¸»é¢˜é€‰æ‹©å™¨æ˜¾ç¤º
  @State forceRefresh: number = 0  // å¼ºåˆ¶åˆ·æ–°æ ‡å¿—
  private omniThemeManager = OmniThemeManager.getInstance()  // Omni-UI ä¸»é¢˜ç®¡ç†å™¨å®žä¾‹
  private omniUIInit = OmniUIInit.getInstance()  // Omni-UI åˆå§‹åŒ–å®žä¾‹
  private omniUIUtils = OmniUIUtils.getInstance()  // Omni-UI å·¥å…·å®žä¾‹
  
  // é¡µé¢åˆå§‹åŒ–æ—¶åˆå§‹åŒ– Omni-UI å’Œ IBest-UI
  aboutToAppear() {
    this.omniUIInit.init()
    this.omniThemeManager.init()
    // æš‚æ—¶æ³¨é‡ŠæŽ‰ IBest-UI åˆå§‹åŒ–ï¼Œé¿å… WindowStage å‚æ•°é—®é¢˜
    // IBestInit({}, windowStage) // åˆå§‹åŒ– IBest-UI
  }
  
  // èŽ·å–å½“å‰ä¸»é¢˜é…ç½®çš„æ–¹æ³•
  getCurrentTheme() {
    // ç¡®ä¿èŽ·å–æœ€æ–°çš„ä¸»é¢˜é…ç½®
    const theme = this.omniThemeManager.getCurrentTheme()
    console.log('èŽ·å–ä¸»é¢˜é…ç½®:', this.currentThemeType, theme)
    return theme
  }

  // åˆ¤æ–­æ˜¯å¦ä¸ºæµ…è‰²ä¸»é¢˜ï¼ˆæ‰€æœ‰å½©è‰²ä¸»é¢˜éƒ½æ˜¯æ·±è‰²ç³»ï¼‰
  isLightTheme(): boolean {
    return false  // æ‰€æœ‰å½©è‰²ä¸»é¢˜éƒ½æ˜¯æ·±è‰²ç³»
  }

  // èŽ·å–å½“å‰ä¸»é¢˜çš„ä¸»è‰²è°ƒï¼ˆåŸºäºŽé¡µé¢çŠ¶æ€ï¼‰
  getThemePrimaryColor(): string {
    const themeConfigs = this.omniThemeManager.getAllThemes()
    const primaryColor = themeConfigs[this.currentThemeType]?.primary
    return typeof primaryColor === 'string' ? primaryColor : '#007AFF'
  }

  build() {
    Stack() {
      Column() {
        // é¡¶éƒ¨åŒºåŸŸï¼šLogoå’Œç”¨æˆ·ä¿¡æ¯ï¼ˆæ¨ªè·¨æ•´ä¸ªå®½åº¦ï¼Œé»‘è‰²èƒŒæ™¯ï¼‰
        Row() {
        // å·¦ä¾§å…¬å¸LogoåŒºåŸŸ
        Row() {
          // ä¸´æ—¶ç”¨æ–‡å­—ä»£æ›¿å›¾ç‰‡
          Text('LOGO')
            .width(40)
            .height(40)
            .fontSize(12)
            .fontColor('#ffffff')
            .textAlign(TextAlign.Center)
            .backgroundColor('#ff0000') // æ”¹æˆçº¢è‰²ï¼Œæ›´å®¹æ˜“çœ‹åˆ°
            .borderRadius(4)
          
           Text('å…¬å¸åç§°')
             .fontSize(18)
             .fontWeight(FontWeight.Medium)
             .fontColor(this.getCurrentTheme().textColor)
             .margin({ left: 12 })
        }
        .alignItems(VerticalAlign.Center)
        .justifyContent(FlexAlign.Start)
        
        Blank()
        
         // å³ä¾§ç”¨æˆ·ä¿¡æ¯åŒºåŸŸ
         Row() {
           // ä¸´æ—¶ç”¨æ–‡å­—ä»£æ›¿å¤´åƒ
           Text('å¤´åƒ')
             .width(36)
             .height(36)
             .fontSize(10)
             .fontColor('#ffffff')
             .textAlign(TextAlign.Center)
             .backgroundColor('#666666')
             .borderRadius(18)
             .border({ width: 2, color: '#ffffff' })
           
           Column() {
             Text('å¼ ä¸‰')
               .fontSize(14)
               .fontWeight(FontWeight.Medium)
               .fontColor(this.getCurrentTheme().surfaceColor)
               .textAlign(TextAlign.End)
             
             Text('ç®¡ç†å‘˜')
               .fontSize(12)
               .fontColor(this.getCurrentTheme().subTextColor)
               .textAlign(TextAlign.End)
           }
           .alignItems(HorizontalAlign.End)
           .margin({ left: 12 })
           
          // ä¸»é¢˜é€‰æ‹©æŒ‰é’® - ä½¿ç”¨ IBest-UI
          IBestButton({
            text: 'ðŸŽ¨',
            type: 'primary',
            buttonSize: 'small',
            round: true,
            onBtnClick: () => {
              // æ˜¾ç¤ºä¸»é¢˜é€‰æ‹©å™¨
              this.showThemeSelector = true
            }
          })
          .margin({ left: 12 })
         }
        .alignItems(VerticalAlign.Center)
        .justifyContent(FlexAlign.End)
       }
       .width('100%')
       .height(60)
       .padding({ left: 20, right: 20 })
       .backgroundColor(this.getCurrentTheme().headerColor) // ä½¿ç”¨ä¸»é¢˜è‰²
      
      // ä¸»è¦å†…å®¹åŒºåŸŸ - ä½¿ç”¨ Omni-UI åº•éƒ¨å¯¼èˆªæ 
      Column() {
        // å†…å®¹æ˜¾ç¤ºåŒºåŸŸ
        Column() {
          if (this.currentPage === 'ä¸»é¡µ') {
            if (this.forceRefresh % 2 === 0) {
              HomeContent()
            } else {
              // ç©ºç»„ä»¶ï¼Œç”¨äºŽå¼ºåˆ¶é‡æ–°æ¸²æŸ“
              Column() {
                HomeContent()
              }
            }
          } else if (this.currentPage === 'æ°´æžœä¿¡æ¯') {
            // æ°´æžœä¿¡æ¯é¡µé¢å†…å®¹
            Column() {
              Text('æ°´æžœä¿¡æ¯é¡µé¢')
                .fontSize(24)
                .fontWeight(FontWeight.Bold)
                .fontColor(this.getCurrentTheme().textColor)
                .margin({ top: 50 })
              
              Text('è¿™é‡Œå°†æ˜¾ç¤ºæ°´æžœçš„è¯¦ç»†ä¿¡æ¯')
                .fontSize(16)
                .fontColor(this.getCurrentTheme().subTextColor)
                .margin({ top: 20 })
            }
            .width('100%')
            .height('100%')
            .justifyContent(FlexAlign.Center)
            .alignItems(HorizontalAlign.Center)
          } else if (this.currentPage === 'è½½å…¥ç¨‹åº') {
            // è½½å…¥ç¨‹åºé¡µé¢å†…å®¹
            Column() {
              Text('è½½å…¥ç¨‹åºé¡µé¢')
                .fontSize(24)
                .fontWeight(FontWeight.Bold)
                .fontColor(this.getCurrentTheme().textColor)
                .margin({ top: 50 })
              
              Text('è¿™é‡Œå°†æ˜¾ç¤ºç¨‹åºè½½å…¥åŠŸèƒ½')
                .fontSize(16)
                .fontColor(this.getCurrentTheme().subTextColor)
                .margin({ top: 20 })
            }
            .width('100%')
            .height('100%')
            .justifyContent(FlexAlign.Center)
            .alignItems(HorizontalAlign.Center)
          } else if (this.currentPage === 'åŽ†å²åŠ å·¥') {
            // åŽ†å²åŠ å·¥é¡µé¢å†…å®¹
            Column() {
              Text('åŽ†å²åŠ å·¥é¡µé¢')
                .fontSize(24)
                .fontWeight(FontWeight.Bold)
                .fontColor(this.getCurrentTheme().textColor)
                .margin({ top: 50 })
              
              Text('è¿™é‡Œå°†æ˜¾ç¤ºåŽ†å²åŠ å·¥è®°å½•')
                .fontSize(16)
                .fontColor(this.getCurrentTheme().subTextColor)
                .margin({ top: 20 })
            }
            .width('100%')
            .height('100%')
            .justifyContent(FlexAlign.Center)
            .alignItems(HorizontalAlign.Center)
          } else if (this.currentPage === 'å®žæ—¶ç»Ÿè®¡') {
            // å®žæ—¶ç»Ÿè®¡é¡µé¢å†…å®¹
            Column() {
              Text('å®žæ—¶ç»Ÿè®¡é¡µé¢')
                .fontSize(24)
                .fontWeight(FontWeight.Bold)
                .fontColor(this.getCurrentTheme().textColor)
                .margin({ top: 50 })
              
              Text('è¿™é‡Œå°†æ˜¾ç¤ºå®žæ—¶ç»Ÿè®¡æ•°æ®')
                .fontSize(16)
                .fontColor(this.getCurrentTheme().subTextColor)
                .margin({ top: 20 })
            }
            .width('100%')
            .height('100%')
            .justifyContent(FlexAlign.Center)
            .alignItems(HorizontalAlign.Center)
          } else if (this.currentPage === 'ç»“æŸåŠ å·¥') {
            // ç»“æŸåŠ å·¥é¡µé¢å†…å®¹
            Column() {
              Text('ç»“æŸåŠ å·¥é¡µé¢')
                .fontSize(24)
                .fontWeight(FontWeight.Bold)
                .fontColor(this.getCurrentTheme().textColor)
                .margin({ top: 50 })
              
              Text('è¿™é‡Œå°†æ˜¾ç¤ºç»“æŸåŠ å·¥åŠŸèƒ½')
                .fontSize(16)
                .fontColor(this.getCurrentTheme().subTextColor)
                .margin({ top: 20 })
            }
            .width('100%')
            .height('100%')
            .justifyContent(FlexAlign.Center)
            .alignItems(HorizontalAlign.Center)
          } else if (this.currentPage === 'æ‰“å°') {
            // æ‰“å°é¡µé¢å†…å®¹
            Column() {
              Text('æ‰“å°é¡µé¢')
                .fontSize(24)
                .fontWeight(FontWeight.Bold)
                .fontColor(this.getCurrentTheme().textColor)
                .margin({ top: 50 })
              
              Text('è¿™é‡Œå°†æ˜¾ç¤ºæ‰“å°åŠŸèƒ½')
                .fontSize(16)
                .fontColor(this.getCurrentTheme().subTextColor)
                .margin({ top: 20 })
            }
            .width('100%')
            .height('100%')
            .justifyContent(FlexAlign.Center)
            .alignItems(HorizontalAlign.Center)
          } else if (this.currentPage === 'æ›´å¤š') {
            // æ›´å¤šé¡µé¢å†…å®¹
            Column() {
              Text('æ›´å¤šé¡µé¢')
                .fontSize(24)
                .fontWeight(FontWeight.Bold)
                .fontColor(this.getCurrentTheme().textColor)
                .margin({ top: 50 })
              
              Text('è¿™é‡Œå°†æ˜¾ç¤ºæ›´å¤šåŠŸèƒ½é€‰é¡¹')
                .fontSize(16)
                .fontColor(this.getCurrentTheme().subTextColor)
                .margin({ top: 20 })
            }
            .width('100%')
            .height('100%')
            .justifyContent(FlexAlign.Center)
            .alignItems(HorizontalAlign.Center)
          } else {
            // é»˜è®¤æ˜¾ç¤ºä¸»é¡µå†…å®¹
            if (this.forceRefresh % 2 === 0) {
              HomeContent()
            } else {
              Column() {
                HomeContent()
              }
            }
          }
        }
        .width('100%')
        .height('100%')
        .backgroundColor(this.getCurrentTheme().surfaceColor)
        .layoutWeight(1)
        
        }
        .width('100%')
        .layoutWeight(1)
      }
      .height('100%')
      .width('100%')
      
      // åº•éƒ¨å¯¼èˆªæ  - ä¸€è¡Œå¸ƒå±€ï¼Œä½¿ç”¨IBestButtonèŽ·å¾—æ–¹æ–¹æ­£æ­£æ ·å¼
      Row() {
        // ä¸»é¡µæŒ‰é’®
        IBestButton({
          text: 'ä¸»é¡µ',
          type: this.currentPage === 'ä¸»é¡µ' ? 'primary' : 'default',
          buttonSize: 'normal',
          plain: this.currentPage !== 'ä¸»é¡µ',
          fontWeight: FontWeight.Bold,
          onBtnClick: () => {
            this.currentPage = 'ä¸»é¡µ'
            console.log('åˆ‡æ¢åˆ°é¡µé¢:', this.currentPage)
            this.omniUIUtils.showInfo(`å·²åˆ‡æ¢åˆ°${this.currentPage}é¡µé¢`)
          }
        })
        .layoutWeight(1)
        .margin({ top: 8, bottom: 8, left: 2, right: 2 })
        
        // æ°´æžœä¿¡æ¯æŒ‰é’®
        IBestButton({
          text: 'æ°´æžœä¿¡æ¯',
          type: this.currentPage === 'æ°´æžœä¿¡æ¯' ? 'primary' : 'default',
          buttonSize: 'normal',
          plain: this.currentPage !== 'æ°´æžœä¿¡æ¯',
          fontWeight: FontWeight.Bold,
          onBtnClick: () => {
            this.currentPage = 'æ°´æžœä¿¡æ¯'
            console.log('åˆ‡æ¢åˆ°é¡µé¢:', this.currentPage)
            this.omniUIUtils.showInfo(`å·²åˆ‡æ¢åˆ°${this.currentPage}é¡µé¢`)
          }
        })
        .layoutWeight(1)
        .margin({ top: 8, bottom: 8, left: 2, right: 2 })
        
        // è½½å…¥ç¨‹åºæŒ‰é’®
        IBestButton({
          text: 'è½½å…¥ç¨‹åº',
          type: this.currentPage === 'è½½å…¥ç¨‹åº' ? 'primary' : 'default',
          buttonSize: 'normal',
          plain: this.currentPage !== 'è½½å…¥ç¨‹åº',
          fontWeight: FontWeight.Bold,
          onBtnClick: () => {
            this.currentPage = 'è½½å…¥ç¨‹åº'
            console.log('åˆ‡æ¢åˆ°é¡µé¢:', this.currentPage)
            this.omniUIUtils.showInfo(`å·²åˆ‡æ¢åˆ°${this.currentPage}é¡µé¢`)
          }
        })
        .layoutWeight(1)
        .margin({ top: 8, bottom: 8, left: 2, right: 2 })
        
        // åŽ†å²åŠ å·¥æŒ‰é’®
        IBestButton({
          text: 'åŽ†å²åŠ å·¥',
          type: this.currentPage === 'åŽ†å²åŠ å·¥' ? 'primary' : 'default',
          buttonSize: 'normal',
          plain: this.currentPage !== 'åŽ†å²åŠ å·¥',
          fontWeight: FontWeight.Bold,
          onBtnClick: () => {
            this.currentPage = 'åŽ†å²åŠ å·¥'
            console.log('åˆ‡æ¢åˆ°é¡µé¢:', this.currentPage)
            this.omniUIUtils.showInfo(`å·²åˆ‡æ¢åˆ°${this.currentPage}é¡µé¢`)
          }
        })
        .layoutWeight(1)
        .margin({ top: 8, bottom: 8, left: 2, right: 2 })
        
        // å®žæ—¶ç»Ÿè®¡æŒ‰é’®
        IBestButton({
          text: 'å®žæ—¶ç»Ÿè®¡',
          type: this.currentPage === 'å®žæ—¶ç»Ÿè®¡' ? 'primary' : 'default',
          buttonSize: 'normal',
          plain: this.currentPage !== 'å®žæ—¶ç»Ÿè®¡',
          fontWeight: FontWeight.Bold,
          onBtnClick: () => {
            this.currentPage = 'å®žæ—¶ç»Ÿè®¡'
            console.log('åˆ‡æ¢åˆ°é¡µé¢:', this.currentPage)
            this.omniUIUtils.showInfo(`å·²åˆ‡æ¢åˆ°${this.currentPage}é¡µé¢`)
          }
        })
        .layoutWeight(1)
        .margin({ top: 8, bottom: 8, left: 2, right: 2 })
        
        // ç»“æŸåŠ å·¥æŒ‰é’®
        IBestButton({
          text: 'ç»“æŸåŠ å·¥',
          type: this.currentPage === 'ç»“æŸåŠ å·¥' ? 'primary' : 'default',
          buttonSize: 'normal',
          plain: this.currentPage !== 'ç»“æŸåŠ å·¥',
          fontWeight: FontWeight.Bold,
          onBtnClick: () => {
            this.currentPage = 'ç»“æŸåŠ å·¥'
            console.log('åˆ‡æ¢åˆ°é¡µé¢:', this.currentPage)
            this.omniUIUtils.showInfo(`å·²åˆ‡æ¢åˆ°${this.currentPage}é¡µé¢`)
          }
        })
        .layoutWeight(1)
        .margin({ top: 8, bottom: 8, left: 2, right: 2 })
        
        // æ‰“å°æŒ‰é’®
        IBestButton({
          text: 'æ‰“å°',
          type: this.currentPage === 'æ‰“å°' ? 'primary' : 'default',
          buttonSize: 'normal',
          plain: this.currentPage !== 'æ‰“å°',
          fontWeight: FontWeight.Bold,
          onBtnClick: () => {
            this.currentPage = 'æ‰“å°'
            console.log('åˆ‡æ¢åˆ°é¡µé¢:', this.currentPage)
            this.omniUIUtils.showInfo(`å·²åˆ‡æ¢åˆ°${this.currentPage}é¡µé¢`)
          }
        })
        .layoutWeight(1)
        .margin({ top: 8, bottom: 8, left: 2, right: 2 })
        
        // æ›´å¤šæŒ‰é’®
        IBestButton({
          text: 'æ›´å¤š',
          type: this.currentPage === 'æ›´å¤š' ? 'primary' : 'default',
          buttonSize: 'normal',
          plain: this.currentPage !== 'æ›´å¤š',
          fontWeight: FontWeight.Bold,
          onBtnClick: () => {
            this.currentPage = 'æ›´å¤š'
            console.log('åˆ‡æ¢åˆ°é¡µé¢:', this.currentPage)
            this.omniUIUtils.showInfo(`å·²åˆ‡æ¢åˆ°${this.currentPage}é¡µé¢`)
          }
        })
        .layoutWeight(1)
        .margin({ top: 8, bottom: 8, left: 2, right: 2 })
      }
      .width('100%')
      .height(80)  // å¢žåŠ å¯¼èˆªæ é«˜åº¦
      .backgroundColor(this.getThemePrimaryColor())  // ä½¿ç”¨é¡µé¢çŠ¶æ€èŽ·å–ä¸»é¢˜è‰²
      .border({ width: { top: 1 }, color: this.getCurrentTheme().borderColor })
      .position({ x: 0, y: '100%' })
      .translate({ y: -80 })  // å‘ä¸Šåç§»å¯¼èˆªæ é«˜åº¦ï¼Œå®Œå…¨è´´æ­»åº•éƒ¨
      
      // ä¸»é¢˜é€‰æ‹©å™¨å¼¹çª—
      if (this.showThemeSelector) {
        ThemeSelector({
          onThemeSelected: (theme: OmniThemeType) => {
            console.log('å¼€å§‹åˆ‡æ¢ä¸»é¢˜:', theme)
            
            // å…ˆè®¾ç½®ä¸»é¢˜ç®¡ç†å™¨ä¸­çš„ä¸»é¢˜
            this.omniThemeManager.setTheme(theme)
            
            // ç„¶åŽæ›´æ–°é¡µé¢çŠ¶æ€ä»¥è§¦å‘ç•Œé¢é‡æ–°æ¸²æŸ“
            this.currentThemeType = theme
            
            // å¼ºåˆ¶åˆ·æ–°æ‰€æœ‰ç»„ä»¶
            this.forceRefresh++
            
            // å…³é—­å¼¹çª—
            this.showThemeSelector = false
            
            // æ˜¾ç¤ºæˆåŠŸæç¤º
            const themeName = this.omniThemeManager.getThemeName(theme)
            this.omniUIUtils.showSuccess(`å·²åˆ‡æ¢åˆ°${themeName}`)
            
            console.log('ä¸»é¢˜åˆ‡æ¢å®Œæˆ:', theme, 'å½“å‰ä¸»é¢˜ç±»åž‹:', this.currentThemeType, 'åˆ·æ–°æ ‡å¿—:', this.forceRefresh)
          },
          onCancel: () => {
            this.showThemeSelector = false
          }
        })
      }
    }
  }
}